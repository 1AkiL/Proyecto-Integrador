<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SGL - Reservar</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />

  <style>
    body { background-color: #fff4ff; }
    .header-img { width: 100%; max-height: 180px; object-fit: cover; }
    .form-panel { background-color: #f8f8f8; padding: 20px; border-radius: 10px; }
    #calendar { background-color: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 8px rgba(0,0,0,0.1); }
    .legend span { display: inline-block; width: 15px; height: 15px; margin-right: 5px; border-radius: 3px; }
    .disponible { background-color: #28a745; }
    .mantenimiento { background-color: orange; }
    .nodisponible { background-color: red; }

    .form-panel .btn {
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: inherit; 
    }
    .form-panel .btn.w-50 {
      width: 45% !important; 
    }
    .form-panel .d-flex {
      justify-content: center; 
    }

    #sidebar-container {
      min-height: 100vh;
      background-color: #f8f9fa;
    }
  </style>
</head>

<body>
  <header>
    <img src="../images/encabezado.png" alt="Encabezado" class="header-img" />
  </header>

  <div class="container-fluid">
    <div class="row">
     
      <div class="col-auto px-0" id="sidebar-container"></div>

      <div class="col">
        <div class="row g-4 p-4">
          <!-- Formulario -->
          <div class="col-12 col-lg-3">
            <div class="form-panel">
              <h5 class="mb-3">Formulario de reserva</h5>
              <form id="formReserva" method="post">
                {%csrf_token%}
                <div class="mb-3">
                  <label for="usuario" class="form-label">Usuario</label>
                  <input type="text" class="form-control" id="usuario" value="{{usuario.username}}" name="username" readonly />
                </div>
                <div class="mb-3">
                  <label for="correo" class="form-label">Correo</label>
                  <input type="email" class="form-control" id="correo" value="{{usuario.email}}" name="email" readonly />
                </div>
                <div class="mb-3">
                  <label for="matricula" class="form-label">Matrícula</label>
                  <input type="text" class="form-control" id="matricula" value="{{usuario.id}}" name="id" readonly />
                </div>
                <div class="mb-3">
                  <label for="fecha_reserva" class="form-label">Fecha de reserva</label>
                  <input type="date" class="form-control" id="fecha_reserva" required  name="fecha_reserva" />
                </div>
                <div class="mb-3">
                  <label for="hora_inicio" class="form-label">Hora inicio</label>
                  <input type="time" class="form-control" id="hora_inicio" required name="hora_inicio" />
                </div>
                <div class="mb-3">
                  <label for="hora_fin" class="form-label">Hora fin</label>
                  <input type="time" class="form-control" id="hora_fin" required name="hora_fin" />
                </div>
                <input type="hidden" id="laboratorio-hidden" value="Laboratorio 1" name="laboratorio" />
                <div class="d-flex gap-3">
                  <button type="reset" class="btn btn-danger w-50">Cancelar</button>
                  <button type="submit" class="btn btn-success w-50">Confirmar</button>
                </div>
              </form>
            </div>
          </div>

          <!-- Calendario -->
          <div class="col-12 col-lg-9">
            <div class="mb-3">
              <label for="laboratorio" class="form-label">Seleccionar laboratorio</label>
              <select class="form-select" id="laboratorio">
                <option value="Laboratorio 1" selected>Laboratorio 1</option>
                <option value="Laboratorio 2">Laboratorio 2</option>
                <option value="Laboratorio 3">Laboratorio 3</option>
                <option value="Laboratorio 4">Laboratorio 4</option>
                <option value="Laboratorio 5">Laboratorio 5</option>
                <option value="Laboratorio 6">Laboratorio 6</option>
                <option value="Laboratorio 7">Laboratorio 7</option>
              </select>
            </div>

            <div class="legend mb-3">
              <span class="disponible"></span> Disponible &nbsp;
              <span class="mantenimiento"></span> En mantenimiento &nbsp;
              <span class="nodisponible"></span> No disponible
            </div>

            <div id="calendar"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="modalReservasDia" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Reservas del día</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <ul id="listaReservasDia" class="list-group"></ul>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  fetch('/sidebar')
    .then(res => res.text())
    .then(html => {
      document.getElementById('sidebar-container').innerHTML = html;
      const titleElement = document.querySelector('#sidebar-container .sidebar-title');
      if (titleElement) titleElement.textContent = 'Reservar';
    })
    .catch(err => console.error('Error al cargar el sidebar:', err));

  inicializarCalendario('Laboratorio 1');

  document.getElementById('laboratorio').addEventListener('change', function () {
    const labIndex = this.selectedIndex + 1; // número del laboratorio
    console.log("Laboratorio seleccionado:", labIndex);
    alert("Laboratorio seleccionado: " + labIndex);
    inicializarCalendario(this.value);
  });
});

function inicializarCalendario(laboratorio) {
  const calendarEl = document.getElementById('calendar');
  calendarEl.innerHTML = ''; 

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'es',
    titleFormat: { year: 'numeric', month: 'long' },
    headerToolbar: {
      left: 'prev,next',
      center: 'title',
      right: ''
    },
    events: [],

    dateClick: function(info) {
      const lista = document.getElementById('listaReservasDia');
      lista.innerHTML = '';

      //aqui va el fetch con la base de datos 

  
      const li = document.createElement('li');
      li.className = 'list-group-item text-muted';
      li.textContent = 'No hay reservas para este día.';
      lista.appendChild(li);

      new bootstrap.Modal(document.getElementById('modalReservasDia')).show();
    }
  });

  calendar.render();
}
</script>

</body>
</html>
