<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SGL - Reservar</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css" rel="stylesheet" />

<style>
  body { background-color: #fff4ff; }

  .header-img {
    width: 100%;
    max-height: 180px;
    object-fit: cover;
  }

  
  .form-panel {
    background-color: #f8f8f8;
    padding: 28px 24px;
    border-radius: 10px;
    width: 100%;
  }

  .form-panel h5 {
    margin-bottom: 16px;
  }

  #calendar {
    font-size: 0.9rem;
    background: #fff; 
    border-radius: 10px;
    box-shadow: 0 3px 15px rgba(0,0,0,0.12);
    max-width: 720px;
    margin: 0 auto;
    overflow-x: auto;
    padding: 10px;
  }

 
  .fc-col-header-cell {
    background-color: #501f65;
    color: #fff !important;
    border: 1px solid #ddd;
    padding: 8px 0;
    font-weight: 700;
    text-align: center;
    text-transform: capitalize;
  }

  
  .fc-col-header-cell-cushion {
    color: #fff !important;
    text-decoration: none !important;
  }

  
  .fc-daygrid-day {
    border: 1px solid #ddd !important;
    padding: 10px 8px !important;
    vertical-align: top;
    background-color: #fff;
    cursor: pointer;
    transition: background-color 0.15s ease-in-out;
    color: #501f65;
  }

  
  .fc-daygrid-day:hover {
    background-color: #f0e6ff;
  }

  
  .fc-daygrid-day a {
    color: #501f65 !important;
    text-decoration: none !important;
    display: block;
  }

  
  .fc-daygrid-day a:hover {
    text-decoration: none !important;
  }

  
  .fc-daygrid-day-number {
    color: #501f65 !important;
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 6px;
    display: inline-block;
  }

  .legend span {
  display: inline-block;
  width: 14px;
  height: 14px;
  border-radius: 3px;
  margin-right: 6px;
}

.mantenimiento {
  background-color: orange; 
}

.nodisponible {
  background-color: red; 
}

</style>
</head>
<body>
<header>
    {% load static %}
    <img src="{% static 'sistemaGestion/encabezado.png' %}" alt="Encabezado" class="header-img" /></header>

<div class="container-fluid">
  <div class="row">
    <div class="col-auto px-0" id="sidebar-container"></div>
    <div class="col">
      <div class="row g-4 p-4 flex-column flex-lg-row">
        <div class="col-12 col-lg-3">
          <div class="form-panel">
            <h5 class="mb-3">Formulario de reserva</h5>
            <form id="formReserva" method="post">
              {% csrf_token %}
              <div class="mb-3">
                <label for="usuario" class="form-label">Usuario</label>
                <input type="text" class="form-control" id="usuario" value="{{usuario.username}}" name="username" readonly />
              </div>
              <div class="mb-3">
                <label for="correo" class="form-label">Correo</label>
                <input type="email" class="form-control" id="correo" value="{{usuario.email}}" name="email" readonly />
              </div>
              <div class="mb-3">
                <label for="matricula" class="form-label">Matrícula</label>
                <input type="text" class="form-control" id="matricula" value="{{usuario.id}}" name="matricula" readonly />
              </div>
              <div class="mb-3">
                <label for="fecha_reserva" class="form-label">Fecha de reserva</label>
                <input type="date" class="form-control" id="fecha_reserva" name="fecha_reserva" required />
              </div>
              <div class="mb-3">
                <label for="hora_inicio" class="form-label">Hora inicio</label>
                <input type="time" class="form-control" id="hora_inicio" name="hora_inicio" required />
              </div>
              <div class="mb-3">
                <label for="hora_fin" class="form-label">Hora fin</label>
                <input type="time" class="form-control" id="hora_fin" name="hora_fin" required />
              </div>
              <input  id="laboratorio-hidden" name="laboratorio" value="Laboratorio 1" />
              <div class="d-flex gap-3">
                <button type="reset" class="btn btn-danger w-50">Cancelar</button>
                <button type="submit" class="btn btn-success w-50">Confirmar</button>
              </div>
            </form>
          </div>
        </div>
        <div class="col-12 col-lg-9">
          <div class="mb-3">
            <label for="laboratorio" class="form-label">Seleccionar laboratorio</label>
            <select class="form-select" id="laboratorio">
              <option value="Laboratorio 1" selected>Laboratorio 1</option>
              <option value="Laboratorio 2">Laboratorio 2</option>
              <option value="Laboratorio 3">Laboratorio 3</option>
              <option value="Laboratorio 4">Laboratorio 4</option>
              <option value="Laboratorio 5">Laboratorio 5</option>
              <option value="Laboratorio 6">Laboratorio 6</option>
              <option value="Laboratorio 7">Laboratorio 7</option>
            </select>
          </div>
          <div class="legend mb-3">
            
            <span class="mantenimiento"></span> En mantenimiento &nbsp;
            <span class="nodisponible"></span> No disponible
          </div>
          <div class="calendar-wrapper" style="position: relative; overflow-x:auto;">
            <div id="calendar"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="modalReservasDia" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Reservas del día</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <ul id="listaReservasDia" class="list-group"></ul>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
  fetch('/sidebar')
    .then(res => res.text())
    .then(html => {
      document.getElementById('sidebar-container').innerHTML = html;
      const titleElement = document.querySelector('#sidebar-container .sidebar-title');
      if (titleElement) titleElement.textContent = 'Reservar';
    })
    .catch(err => console.error('Error al cargar el sidebar:', err));

  inicializarCalendario('Laboratorio 1');

  const laboratorioSelect = document.getElementById('laboratorio');
  laboratorioSelect.addEventListener('change', function () {
    document.getElementById('laboratorio-hidden').value = this.value;
    inicializarCalendario(this.value);
  });
});

function inicializarCalendario(laboratorio) {
  const calendarEl = document.getElementById('calendar');

  if (calendarEl._fcCalendar) {
    try { calendarEl._fcCalendar.destroy(); } catch (e) {}
    calendarEl._fcCalendar = null;
  }

  calendarEl.innerHTML = '';

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',  
    locale: 'es',
    firstDay: 0,
    hiddenDays: [],
    fixedWeekCount: false,
    dayHeaderFormat: { weekday: 'short' },
    titleFormat: { year: 'numeric', month: 'long' },
    headerToolbar: {
      left: 'prev,next',
      center: 'title',
      right: '' 
    },
    contentHeight: 600,
    events: [],
    dateClick: function(info) {
      const lista = document.getElementById('listaReservasDia');
      lista.innerHTML = '';
      const li = document.createElement('li');
      li.className = 'list-group-item text-muted';
      li.textContent = 'No hay reservas para este día.';
      lista.appendChild(li);
      const modal = new bootstrap.Modal(document.getElementById('modalReservasDia'));
      modal.show();
    }
  });

  calendar.render();
  calendarEl._fcCalendar = calendar;
}
</script>
</body>
</html>
